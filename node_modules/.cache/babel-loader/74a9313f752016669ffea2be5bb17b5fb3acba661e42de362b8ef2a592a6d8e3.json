{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Modal,Button}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AlertComponent(){const[alerta,setAlerta]=useState(null);const[previousIntensity,setPreviousIntensity]=useState(null);useEffect(()=>{const fetchData=async()=>{try{const response=await fetch('http://localhost:8095/api/v1/alertas');const data=await response.json();if(data.intensidad!==previousIntensity){setAlerta(data);setPreviousIntensity(data.intensidad);}}catch(error){console.error('Error al obtener las alertas:',error);}};// Solicitar permiso de notificación al montar el componente\nif(Notification.permission!=='granted'&&Notification.permission!=='denied'){Notification.requestPermission().then(permission=>{if(permission!=='denied'){fetchData();// Si se otorga el permiso o no se niega, obtener las alertas\n}});}else{fetchData();// Si ya se otorgó el permiso, obtener las alertas\n}const interval=setInterval(fetchData,1000);// Realizar la solicitud cada segundo\nreturn()=>clearInterval(interval);// Limpiar el intervalo al desmontar el componente\n},[previousIntensity]);useEffect(()=>{// Enviar notificación si la intensidad es mayor o igual a 4\nif(alerta!==null&&alerta!==void 0&&alerta.intensidad&&alerta.intensidad>=4){showNotification(alerta.intensidad,alerta.alerta);}},[alerta]);// Función para mostrar la notificación\nconst showNotification=(intensidad,message)=>{if(Notification.permission==='granted'){const notification=new Notification(\"Alerta - Se detect\\xF3 un sismo de: \".concat(intensidad),{body:message});notification.onclick=()=>{window.open('http://localhost:3000/','_blank');// Open in a new tab\n// Alternatively, if you want to redirect in the same tab:\n// window.location.href = 'http://localhost:3000/';\n};}};return/*#__PURE__*/_jsxs(Modal,{show:alerta&&alerta.intensidad>=4,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"\\xA1Alerta!\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Intensidad del sismo: \",alerta===null||alerta===void 0?void 0:alerta.intensidad]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Fecha: \",alerta===null||alerta===void 0?void 0:alerta.fecha]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Hora: \",alerta===null||alerta===void 0?void 0:alerta.hora]}),/*#__PURE__*/_jsx(\"p\",{children:alerta===null||alerta===void 0?void 0:alerta.alerta})]}),/*#__PURE__*/_jsx(Modal.Footer,{children:/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setAlerta(null),children:\"Cerrar\"})})]});}export default AlertComponent;","map":{"version":3,"names":["React","useState","useEffect","Modal","Button","jsx","_jsx","jsxs","_jsxs","AlertComponent","alerta","setAlerta","previousIntensity","setPreviousIntensity","fetchData","response","fetch","data","json","intensidad","error","console","Notification","permission","requestPermission","then","interval","setInterval","clearInterval","showNotification","message","notification","concat","body","onclick","window","open","show","children","Header","closeButton","Title","Body","fecha","hora","Footer","variant","onClick"],"sources":["/home/luis/Documentos/PisCuarto/proyecto.v2/fronend/rutas_evacuacion/src/components/AlertComponent.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Modal, Button } from 'react-bootstrap';\n\nfunction AlertComponent() {\n  const [alerta, setAlerta] = useState(null);\n  const [previousIntensity, setPreviousIntensity] = useState(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const response = await fetch('http://localhost:8095/api/v1/alertas');\n        const data = await response.json();\n\n        if (data.intensidad !== previousIntensity) {\n          setAlerta(data);\n          setPreviousIntensity(data.intensidad);\n        }\n      } catch (error) {\n        console.error('Error al obtener las alertas:', error);\n      }\n    };\n\n    // Solicitar permiso de notificación al montar el componente\n    if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {\n      Notification.requestPermission().then((permission) => {\n        if (permission !== 'denied') {\n          fetchData(); // Si se otorga el permiso o no se niega, obtener las alertas\n        }\n      });\n    } else {\n      fetchData(); // Si ya se otorgó el permiso, obtener las alertas\n    }\n\n    const interval = setInterval(fetchData, 1000); // Realizar la solicitud cada segundo\n\n    return () => clearInterval(interval); // Limpiar el intervalo al desmontar el componente\n  }, [previousIntensity]);\n\n  useEffect(() => {\n    // Enviar notificación si la intensidad es mayor o igual a 4\n    if (alerta?.intensidad && alerta.intensidad >= 4) {\n      showNotification(alerta.intensidad, alerta.alerta);\n    }\n  }, [alerta]);\n\n  // Función para mostrar la notificación\n  const showNotification = (intensidad, message) => {\n    if (Notification.permission === 'granted') {\n      const notification = new Notification(`Alerta - Se detectó un sismo de: ${intensidad}`, { body: message });\n      \n      notification.onclick = () => {\n        window.open('http://localhost:3000/', '_blank'); // Open in a new tab\n        // Alternatively, if you want to redirect in the same tab:\n        // window.location.href = 'http://localhost:3000/';\n      };\n    }\n  };\n\n  return (\n    <Modal show={alerta && alerta.intensidad >= 4}>\n      <Modal.Header closeButton>\n        <Modal.Title>¡Alerta!</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <p>Intensidad del sismo: {alerta?.intensidad}</p>\n        <p>Fecha: {alerta?.fecha}</p>\n        <p>Hora: {alerta?.hora}</p>\n        <p>{alerta?.alerta}</p>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"secondary\" onClick={() => setAlerta(null)}>\n          Cerrar\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n\nexport default AlertComponent;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}